<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Vocab</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Google Fonts for classy look -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="/static/style.css" rel="stylesheet" />
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <span class="logo">üìù</span>
      <h1>Vocab for Elevenplus</h1>
    </div>
    <nav class="mode-switch">
      <button class="tab-btn active" data-tab="wordcard">Word Card Search</button>
      <button class="tab-btn" data-tab="future" disabled style="opacity:.5;cursor:not-allowed;">More Coming</button>
    </nav>
  </header>

  <main class="container">
    <!-- ============== WORD CARD SEARCH ============== -->
    <section id="tab-wordcard" class="tab-panel active">
      <div class="card">
        <h2>üóÇÔ∏è Word Card Search</h2>
        <form id="word-form" class="form-grid" onsubmit="return false;">
          <div class="field">
            <label for="word-input">Enter a word</label>
            <input id="word-input" type="text" placeholder="Type a word (e.g. Page¬π)" autocomplete="off" />
            <small class="help">Or <a href="#" id="show-all-link">Show All</a></small>
          </div>
          <div class="actions">
            <button id="btn-search" class="btn primary">Show Card</button>
          </div>
        </form>
        <div id="word-list" class="result-block" style="display:none; max-height:220px; overflow-y:auto;">
          <h3>Word List</h3>
          <ul id="word-list-ul" class="word-list-ul"></ul>
        </div>
        <div id="word-card-scroll" class="word-card-scroll" style="display:none;"></div>
        <!-- Template for dynamic card rendering -->
        <template id="vocab-card-template">
          <div class="vocab-card">
            <div class="word-title"><strong>Word :</strong> <span class="word-value"></span></div>
            <div class="vocab-section">
              <span class="vocab-label">Meaning :</span>
              <span class="meaning-value"></span>
            </div>
            <div class="vocab-section">
              <span class="vocab-label">Usage in a Simple Sentence :</span>
              <span class="usage-value"></span>
            </div>
            <div class="vocab-section">
              <span class="vocab-label">Ways to Remember the Meaning</span>
              <ul class="ways-list"></ul>
            </div>
            <div class="vocab-section">
              <span class="vocab-label">Synonyms & Antonyms</span>
              <ul class="syn-ant-list"></ul>
            </div>
            <div class="vocab-section">
              <span class="vocab-label">Additional facts</span>
              <ul class="additional-list"></ul>
            </div>
          </div>
        </template>
        <!-- End template -->
      </div>
    </section>
    <!-- ============== FUTURE TABS PLACEHOLDER ============== -->
    <section id="tab-future" class="tab-panel">
      <div class="card center muted" style="min-height:180px;display:flex;align-items:center;justify-content:center;">
        More features coming soon!
      </div>
    </section>
  </main>
  <footer class="app-footer">
    <div>¬© Vocab for ElevenPlus ‚Ä¢ Demo UI</div>
    <div class="tiny">Frontend only ‚Äì hook to your backend later.</div>
  </footer>
  <script>
    // Tab switching
    const tabs = document.querySelectorAll(".tab-btn");
    const panels = document.querySelectorAll(".tab-panel");
    tabs.forEach(btn => {
      btn.addEventListener("click", () => {
        tabs.forEach(b => b.classList.remove("active"));
        panels.forEach(p => p.classList.remove("active"));
        btn.classList.add("active");
        document.getElementById("tab-" + btn.dataset.tab).classList.add("active");
      });
    });

    // Show card on search
    document.getElementById("btn-search").addEventListener("click", async e => {
      e.preventDefault();
      const word = document.getElementById("word-input").value.trim();
      if (word) showWordCard(word);
    });

    // Render word card
    async function showWordCard(word) {
      const resp = await fetch(`/api/word?word=${encodeURIComponent(word.toLowerCase())}`);
      const data = await resp.json();
      const scroll = document.getElementById("word-card-scroll");
      scroll.innerHTML = "";
      if (!data.word) {
        scroll.style.display = "block";
        scroll.innerHTML = `<div class="vocab-card"><div class="word-title">Word not found.</div></div>`;
        return;
      }
      const tpl = document.getElementById("vocab-card-template").content.cloneNode(true);
      tpl.querySelector(".word-value").textContent = data.word || "";
      tpl.querySelector(".meaning-value").textContent = data.meaning || "";
      tpl.querySelector(".usage-value").textContent = data.usage || "";

      // Ways to remember
      const waysList = tpl.querySelector(".ways-list");
      
      if (data.etymology)
        waysList.innerHTML += `<li><strong>Etymology:</strong> ${data.etymology}</li>`;
      if (data.word_break)
        waysList.innerHTML += `<li><strong>Word Break:</strong> ${data.word_break}</li>`;
      if (data.picture)
        waysList.innerHTML += `<li><strong>Picture:</strong> ${data.picture}</li>`;
      if (data.did_you_know_facts)
        waysList.innerHTML += `<li><strong>Did You Know Facts?:</strong> ${data.did_you_know_facts}</li>`;
      

      // Synonyms & Antonyms
      const synAntList = tpl.querySelector(".syn-ant-list");
      if (data.synonyms)
        synAntList.innerHTML += `<li><strong>Synonyms:</strong> ${data.synonyms}</li>`;
      if (data.antonyms)
        synAntList.innerHTML += `<li><strong>Antonyms:</strong> ${data.antonyms}</li>`;

      // Additional facts
      const addList = tpl.querySelector(".additional-list");
      if (data.additional_facts) {
      // Ensure it's treated as a string, then split by '.' or '\n'
      const facts = data.additional_facts
        .toString()
        .split(/[\.\n]+/)       // split by '.' or newline
        .map(f => f.trim())     // remove extra spaces
        .filter(f => f.length); // remove empty entries

      facts.forEach(fact => {
        addList.innerHTML += `<li>${fact}</li>`;
      });
      }

      scroll.appendChild(tpl);
      scroll.style.display = "block";
    }

    // Hide card area on load
    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("word-card-scroll").style.display = "none";
    });

    // Hide card area when searching with empty input
    document.getElementById("btn-search").addEventListener("click", e => {
      const word = document.getElementById("word-input").value.trim();
      if (!word) {
        document.getElementById("word-card-scroll").style.display = "none";
      }
    });

    // Fetch and show all words (Show All / Hide All functionality)
    async function fetchAndShowAllWords(e) {
      e.preventDefault();
      const wl = document.getElementById("word-list");
      const showAllLink = document.getElementById("show-all-link");
      wl.style.display = wl.style.display === "none" ? "block" : "none";
      if (wl.style.display === "block") {
        showAllLink.textContent = "Hide All";
        const resp = await fetch("/api/words");
        const words = await resp.json();
        document.getElementById("word-list-ul").innerHTML = words.map(w =>
          `<li><a href="#" class="word-link">${w}</a></li>`
        ).join("");
      } else {
        showAllLink.textContent = "Show All";
      }
    }
    document.getElementById("show-all-link").addEventListener("click", fetchAndShowAllWords);

    // Show card on word list click
    document.getElementById("word-list-ul").addEventListener("click", async e => {
      if (e.target.classList.contains("word-link")) {
        e.preventDefault();
        showWordCard(e.target.textContent.trim());
      }
    });
  </script>
</body>
</html>
